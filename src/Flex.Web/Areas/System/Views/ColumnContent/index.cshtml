<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link href="~/Scripts/layui/css/layui.css" rel="stylesheet" />
    <script src="~/Scripts/layui/layui.js" type="text/javascript"></script>
    <script src="~/scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/route.js" type="text/javascript"></script>
    <link href="~/Scripts/layui/css/iconfont/iconfont.css" rel="stylesheet" />
    <link href="~/system/css/columncontent/content.css" rel="stylesheet" />
    <script src="~/system/js/columncontent/openpageoptions.js"></script>
</head>
<body>
    <form action="" onclick="return false;" class="search-box">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">关键字</label>
                <div class="layui-input-inline">
                    <input type="text" name="keyword" lay-verify="keyword" placeholder="关键字" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">日期范围</label>
                <div class="layui-inline" id="ID-laydate-range">
                    <div class="layui-input-inline">
                        <input type="text" autocomplete="off" id="ID-laydate-start-date" class="layui-input" placeholder="开始日期">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline">
                        <input type="text" autocomplete="off" id="ID-laydate-end-date" class="layui-input" placeholder="结束日期">
                    </div>
                </div>
            </div>
            <div class="layui-inline">
                <button class="layui-btn layui-btn-sm" lay-submit lay-filter="formDemo">搜索</button>
            </div>
        </div>
    </form>
    <div class="layui-tab-content">
        <table id="demo_tree" lay-filter="test"></table>
    </div>
    <script type="text/html" id="toolbarDemo">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="addRole">添加</button>
            <button class="layui-btn layui-btn-sm" lay-event="Edit">编辑</button>
            <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="deleteAll">删除</button>
        </div>
    </script>
    <script>
        var routeLink = api + 'ColumnContent/';
        var routePageLink = '/system/ColumnContent/';
        var columnlist;
        $.ajax({
            url: routeLink + 'Column',
            type: 'Get',
            async: false,
            dataType: 'json',
            success: function (result) {
                columnlist = result.content;
            },
            complete: function () { }
        })
        layui.use(['form', 'laydate', 'util',"table"], function () {
            var form = layui.form;
            var laydate = layui.laydate;
            var table = layui.table;
            // 日期范围 - 左右面板独立选择模式
            laydate.render({
                elem: '#ID-laydate-range',
                range: ['#ID-laydate-start-date', '#ID-laydate-end-date']
            });
            //JS 调用：
            var insTb = table.render({
                elem: '#demo_tree'
                , url: routeLink + 'ListAsync'
                , height: 'full-120'
                , headers: httpTokenHeaders
                , toolbar: '#toolbarDemo'
                , limits: [1, 5, 10, 15, 20]
                , limit: 15
                , page: true //开启分页
                , response: {
                    statusCode: 200
                },
                parseData: function (res) {
                    return {
                        "code": res.code, //数据状态的字段名称，默认：code
                        "count": res.content.TotalCount, //状态信息的字段名称，默认：msg
                        "data": res.content.Items//数据总数的字段名称，默认：count
                    };
                }
                , done: function (res, curr, count) {
                    //console.log(columnlist);
                }
                , method: 'Get'
                , cols: [columnlist]
            });

            //监听事件
            table.on('toolbar(test)', function (obj) {
                var data = table.checkStatus(obj.config.id).data;
                switch (obj.event) {
                    case 'addRole':
                        defaultOptions.setAddIframe(layer, insTb);
                        break;
                    case 'deleteAll':
                        if (data.length == 0)
                            return;
                        //获取所有选中节点id数组
                        var nodeIds = defaultOptions.getCheckedId(data);
                        layer.confirm('确定删除选中数据吗？', { btn: ['确定删除', '取消'] }, function (index) {
                            ajaxHttp({
                                url: routeLink + nodeIds,
                                type: 'Delete',
                                async: false,
                                success: function (json) {
                                    if (json.code == 200) {
                                        layer.msg(json.msg, { icon: 6, time: 1000 });
                                        // 删除
                                        delete_index = [];
                                        defaultOptions.callBack(insTb);
                                    } else {
                                        layer.msg(json.msg, { icon: 5, time: 1000 })
                                        delete_index = [];
                                    }
                                },
                                complete: function () { }
                            })
                        })
                        break;

                };
            });
        })
    </script>
</body>
</html>